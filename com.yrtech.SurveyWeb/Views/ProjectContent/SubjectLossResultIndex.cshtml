<div class="form-horizontal form-label-left" style="padding-bottom:5px;width:100%">
    <div class="item form-group" style="float:left; width:80%">
        <div class="col-md-5">
            <input id="LossResultName" type="text" class="form-control" placeholder="失分说明">
        </div>
        <button id="btnAdd" class="btn btn-primary col-md-3" style="margin-right:0px" onclick="saveSubjectLossResult()" data-loading-text="提交中...">保存</button>
    </div>
    <div class="clearfix"></div>
</div>
<div class="result">
    <table id="subject-lossResult-table" class="table table-bordered table-set"></table>
</div>
<script>
    $(function () {
        initSubjectLossResult();
        loadSubjectLossResult();
    })
    function initSubjectLossResult() {
        $('#subject-lossResult-table').bootstrapTable({
            pagination: true,
            striped: true, //是否显示行间隔色
            width: "100%",
            height: getClientHeight() - 260,
            showColumns: false, // 开启自定义列显示功能
            sortable: true,
            pageNumber: 1,
            pageSize: 15,
            pageList: [5, 10, 20, 50],
            columns: [{
                title: "序号",
                field: 'SeqNO',
                width: 120,
                valign: "middle",
                align: "center",
            }, {
                title: "失分说明",
                field: "LossResultName",
                width: 120,
                valign: "middle",
                align: "center",
                sortable: false
            }, {
                title: "删除",
                field: "",
                width: 120,
                valign: "middle",
                align: "center",
                sortable: false,
                formatter: function (value, row, index) {
                    return '<a href="javascript:delSubjectLossResutl();" style="min-width:100px">删除</a>';
                }
            }, {
                title: "添加时间",
                field: "InDateTime",
                width: 150,
                valign: "middle",
                align: "center",
                sortable: false
            }],
            onClickRow: function (row, $element) {
                curRow = row;
            }
        });
    }
    function loadSubjectLossResult() {
        debugger
        $('#subject-lossResult-table').bootstrapTable("showLoading");
        $.commonGet("Master/GetSubjectLossResult", {
            projectId: $("#project-sel").val(),
            subjectId: curRow.SubjectId
        }, function (data) {
            $('#subject-lossResult-table').bootstrapTable("hideLoading");
            $('#subject-lossResult-table').bootstrapTable("load", data);
        });
    }
    function saveSubjectLossResult() {
        var lossResultName = $("#LossResultName").val();
        if (!lossResultName) {
            alert("请输入失分说明！");
            return false;
        }

        $("#btnAdd").button("loading");
        $.commonPost("Master/SaveLossResult", {
            SubjectId: curRow.SubjectId,
            LossResultName: lossResultName,
            InUserId: loginUser.Id,
            ModifyUserId: loginUser.Id
        }, function () {
            $("#btnAdd").button("reset");
            alert("保存成功！");
            $("#LossResultName").val("");
            loadSubjectLossResult();
        });
    }
    function delSubjectLossResutl() {
        $.commonPost("Master/DeleteSubjectLossResult", { SubjectId: curRow.SubjectId, SeqNO: curRow.SeqNO }, function () {
            loadSubjectLossResult();
        });
    }
</script>



