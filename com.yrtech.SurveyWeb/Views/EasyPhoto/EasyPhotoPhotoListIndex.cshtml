@{
    ViewBag.Title = "轻松拍-拍照定义管理";
}
<div class="page-title">
    <div class="title_left">
        <h3>拍照定义管理 <small></small></h3>
    </div>
</div>
@Html.Partial("_PartialSearchCondition")
<table id="photo-list-table" class="table table-striped table-bordered dt-responsive">
    <thead>
        <tr>
            <th width="100">照片编号</th>
            <th>照片名称</th>
            <th width="100">是否新增</th>
            <th width="180">登记时间</th>
            <th width="180">最新修改时间</th>
            <th width="100">操作</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<div id="pagination" class="pull-right">
    <ul id="pageUl"></ul>
</div>
<div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-hidden="false" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button id="save_button" type="button" onclick="saveEasyPhotoPhotoList()" class="btn btn-primary" data-loading-text="提交中...">保存</button>
                <button id="close_button" type="button" onclick="javascript:closeModel();" class="btn btn-default">关闭</button>
            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/api/common.js"></script>
<script src="~/Scripts/api/easyphoto.js"></script>
<script src="~/Scripts/form-serialize.js"></script>
<script src="~/Scripts/page.js"></script>
<script>
    $(function () {
        loadEasyPhotoProjectDropList();
        $("#project-sel").change(function () {
            loadEasyPhotoMasterCommonGet("GetCheckTypeList", {
                projectId: $("#project-sel").val(),
                checkTypeId: '',
                checkTypeName: '',
            }, function (data) {
                $("#checktype-sel").empty();
                if (data) {
                    $.each(data, function () {
                        $("#checktype-sel").append($("<option>").val(this.CheckTypeId).text(this.CheckTypeName));
                    });
                }
            })
        })

        $("#btnSearch").click(function () {
            loadEasyPhotoPhotoList($("#project-sel").val(), $("#checktype-sel").val());
        });

        $("#btnAdd").click(function () {
            $("#Modal").modal("show");
            $("#Modal .modal-body").load("/EasyPhoto/EasyPhotoPhotoListEdit", {}, function () {
            })
            return false;
        });
    })

    //保存轻松拍的拍照定义
    function saveEasyPhotoPhotoList() {
        saveEasyPhotoCommonObject("SavePhotoList", $("#photo-list-form"), {
            TenantId: loginUser.TenantId,
            InUserId: loginUser.Id,
            ModifyUserId: loginUser.Id,
            AddCheck: 'Y',
            ProjectId: $("#project-sel").val(),
            CheckTypeId: $("#checktype-sel").val()
        }, function () {
            $("#btnSearch").click();
        });
    }
    // 查询轻松拍的拍照定义
    function loadEasyPhotoPhotoList(projectId, checkTypeId) {
        loadEasyPhotoMasterCommonGet("GetPhotoList", {
            projectId: projectId,
            checkTypeId: checkTypeId,
            addCheck: ''
        }, function (data) {
            var pageClick = function (curPage) {
                bindTable(data, $("#photo-list-table"), curPage);
            }
            pageClick(curPageNum);
            createPage(data.length, curPageNum, pageSize, pageClick);
        })
    }

    function bindTable(data, table, curPage) {
        $("tbody", table).empty();

        var pageLst = data.filter(function (item, i, self) {
            var start = curPage > 0 ? (curPage - 1) * pageSize : 0;
            return (i >= start && i < (start + pageSize));
        })
        $.each(pageLst, function (i, item) {
            //page
            var tr = $("<tr>");

            tr.append($("<td></td>").html(item.PhotoId));
            tr.append($("<td></td>").html(item.PhotoName));
            tr.append($("<td></td>").html(item.AddCheck == 'Y' ? '是' : '否'));
            tr.append($("<td></td>").html(item.InDateTime || item.InDateTime.replace('T', ' ')));
            if (item.ModifyDateTime) {
                tr.append($("<td></td>").html(item.ModifyDateTime.replace('T', ' ')));
            } else {
                tr.append($("<td></td>").html(''));
            }
            var edit = $("<a href='#'>编辑</a>");
            edit.click(function () {
                $("#Modal").modal("show");
                $("#Modal .modal-body").load("/EasyPhoto/EasyPhotoPhotoListEdit", {}, function () {
                    $("#photo-list-form").setForm(item);
                    $("#photo-list-form").data("json", JSON.stringify(item));
                })
                return false;
            })
            tr.append($("<td></td>").append(edit));

            $("tbody", table).append(tr);
        })
    }
</script>

